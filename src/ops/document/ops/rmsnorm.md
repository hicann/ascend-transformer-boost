# RmsNorm

## 参数说明

- **OpName**：NormOperation
- **PARAM**
  **Param Type**：OpParam::Norm

| 名称          | 类型     | 描述                        |
| ------------- | -------- | --------------------------- |
| normType      | enum     | RMS_NORM                    |
| epsilon       | float    | LayerNorm/RmsNorm类算子属性 |
| inGamma       | bool     | True                        |
| inBeta        | bool     | False                       |
| outRes        | bool     | False                       |
| inRes         | bool     | False                       |
| inNormBias    | bool     | False                       |
| gemmaMode     | uint32_t | 取值为0或1                  |
| precisionMode | uint32_t | 取值为0或1                  |

注：gemmaMode等于1时支持gemma模型；precisionMode等于1时，gamma以half类型参与计算，否则转换至float32类型参与计算。

- **In/Out Tensor**

| 名称  | 类型 | dims                             | dtype             | format |
| ----- | ---- | -------------------------------- | ----------------- | ------ |
| X     | In   | [$d_0$, $d_1$, ..., $d_n$] | float16、bfloat16 | ND     |
| gamma | In   | [1,$d_n$] 或 [$d_n$]         | 与X一致           | ND     |
| Y     | Out  | [$d_0$, $d_1$, ..., $d_n$] | 与X一致           | ND     |

## 功能描述

- 算子功能：RMSNorm假设LayerNorm中的重新居中性质并不是必需的，去除了Mean的统计值的使用，RMSNorm根据均方根（RMS）对某一层中的神经元输入进行规范化，赋予模型重新缩放的不变性属性和隐式学习率自适应能力。相比LayerNorm，RMSNorm在计算上更简单，因此更加高效。
- 计算公式：

  $Y = \frac{x}{RMS(x)}*gamma$

  $RMS(x) = \sqrt{ \frac{1} {n} \sum\limits_{i = 1}^n {x_i^2}+epsilon}$

## 示例

```
输入：
    X = [[15.8984, 10.6406,  8.4531,  0.1094,  8.4844, 14.0391,  1.6094,  8.2188,
          10.1719,  7.6016,  0.7188, 15.1250,  4.9062, 14.3672,  0.5547,  9.9062,
           0.7422,  4.1094,  8.7578,  0.8594,  2.3984, 12.3984,  3.4219, 13.6016,
           6.3281,  2.4219,  0.1406, 11.1172,  6.2188,  2.6406,  7.3281,  1.4766]]
  
gemma = [[1.3516, 11.9531,  4.3047,  5.3125,  2.5156,  1.8203,  6.1094,  2.8984,
          3.2891, 12.2578, 15.2734,  4.9922,  2.3047,  2.5156,  1.2109, 12.6172,
         12.9844, 14.3906, 15.9766, 15.1094,  0.9219, 14.6250,  1.1719, 10.8906,
          7.4219, 11.5938, 11.9609,  4.1250, 11.1094,  9.7266,  6.0547,  7.0938]]

输出:
    Y = [[2.5801, 15.2734,  4.3711,  0.0698,  2.5645,  3.0703,  1.1807,  2.8613,
          4.0195, 11.1953,  1.3184,  9.0703,  1.3584,  4.3398,  0.0807, 15.0156,
          1.1572,  7.1016, 16.8125,  1.5596,  0.2656, 21.7812,  0.4817, 17.7969,
          5.6406,  3.3730,  0.2020,  5.5078,  8.2969,  3.0840,  5.3281,  1.2578]]
```

## 支持芯片型号

| 芯片名称   | 约束                                                           |
| ---------- | -------------------------------------------------------------- |
| ascend910b | 输入tensor最后一维（n）必须32byte对齐                          |
| ascend310p | 输入tensor最后一维（n）必须32byte对齐; 不支持bfloat16数据类型 |
