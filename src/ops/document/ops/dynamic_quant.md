# DynamicQuant

## 参数说明

- **OpName**：ElewiseOperation
- **PARAM**
  **Param Type**：OpParam::Elewise

| 名称        | 类型 | 描述                                        |
| ----------- | ---- | ------------------------------------------- |
| elewiseType | enum | ELEWISE_DYNAMIC_QUANT                       |
| asymmetric  | bool | 是否为非对称量化(暂时只支持false, 对称量化) |

- **In/Out Tensor**

| 名称   | 类型 | dims                                 | dtype            | format |
| ------ | ---- | ------------------------------------ | ---------------- | ------ |
| x      | In   | [$d_0$, $d_1$, ..., $d_n$]     | float16,bfloat16 | ND     |
| y      | Out  | [$d_0$, $d_1$, ..., $d_n$]     | int8             | ND     |
| scale  | Out  | [$d_0$, $d_1$, ..., $d_{n-1}$] | float            | ND     |
| offset | Out  | [$d_0$, $d_1$, ..., $d_{n-1}$] | float            | ND     |

## 功能描述

- 算子功能：对Tensor的尾轴进行对称量化。
- 计算公式：

```
对称量化：
    scale = max(abs(x)) / 127;
    y = round(x / scale);
```

## 示例

对称量化示例：

```
输入：
    x = [[[ 5.273, 6.836,  11.99,   6.01],
          [  9.42,  15.3, -4.484, -3.783]],
         [[-2.002, 0.746,  3.756,  15.11],
          [ -3.05,  12.1,   5.81, -1.298]]]

输出：
    y = [[[ 56,  72, 127,  64],
          [ 78, 127, -37, -31]],
         [[-17,   6,  32, 127],
          [-32, 127,  61, -14]]]

    scale = [[0.09442668, 0.12044784],
             [0.11897146, 0.0952879 ]]
```

## 支持芯片型号

| 芯片名称   | 约束                                                                                                   |
| ---------- | ------------------------------------------------------------------------------------------------------ |
| ascend910b | float16类型尾轴可支持的最大数据量为23552; bfloat16类型尾轴可支持的最大数据量为7167; 暂时只支持对称量化 |
| ascend310p | 尾轴只支持32位对齐的数据，尾轴可支持的最大数据量为4096，暂时只支持对称量化;不支持bfloat16数据类型      |
