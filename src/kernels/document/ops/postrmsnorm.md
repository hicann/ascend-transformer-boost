# PostRmsNorm

## 参数说明

- **OpName**：NormOperation
- **PARAM**
  **Param Type**：OpParam::Norm

| 名称          | 类型     | 描述                        |
| ------------- | -------- | --------------------------- |
| normType      | enum     | RMS_NORM                    |
| epsilon       | float    | LayerNorm/RmsNorm类算子属性 |
| inGamma       | bool     | True                        |
| inBeta        | bool     | True                        |
| inRes         | bool     | True                        |
| inNormBias    | bool     | False                       |
| outRes        | bool     | False                       |
| precisionMode | uint32_t | 取值为0或1                  |

注：precisionMode等于1时，gamma以half类型参与计算，否则转换至float32类型参与计算。

- **In/Out Tensor**

| 名称   | 类型 | dims                                  | dtype             | format |
| ------ | ---- | ------------------------------------- | ----------------- | ------ |
| X      | In   | [$batch$, $seq$, $embed_{dim}$] | float16、bfloat16 | ND     |
| beta   | In   | [1,$embed_{dim}$]                   | 与X一致           | ND     |
| res_in | In   | [$batch$, $seq$, $embed_{dim}$] | 与X一致           | ND     |
| gamma  | In   | [1,$embed_{dim}$]                   | 与X一致           | ND     |
| Y      | Out  | [$batch$, $seq$, $embed_{dim}$] | 与X一致           | ND     |

## 功能描述

- 算子功能：将输入X、res_in和beta（可选参数）相加得到的结果进行RmsNorm操作得到输出Y。
- 计算公式：

  $Y = \frac{X+beta+res_{in}}{RMS(X+beta+res_{in})}*gamma$

  $RMS(x) = \sqrt{ \frac{1} {n} \sum\limits_{i = 1}^n {x_i^2}+epsilon}$

## 示例

```
输入：
     X = [[[201.0000, 150.7500, 201.3750, 214.3750,  70.8750, 224.0000, 126.7500,
            213.6250, 253.0000, 195.1250,  57.1250, 248.6250,  13.2500, 235.2500,
              0.8750, 41.1250]]]

  beta = [[145.0000, 134.5000, 196.8750,  29.7500, 129.2500, 177.6250,  87.1250,
           122.8750, 137.3750, 105.5000, 195.6250,  28.3750,   1.1250, 247.7500,
           142.7500, 90.3750]]

res_in = [[[102.1250, 117.8750,  72.0000, 134.7500,  45.5000, 221.1250,  70.7500,
            114.5000, 129.7500,  23.1250, 251.6250,  96.1250,  62.6250,  39.3750,
            195.3750, 112.6250]]]

     g = [[164.0000, 196.0000, 155.0000,  47.1250,  51.0000,  81.3750,  73.2500,
            96.1250, 148.1250, 233.8750, 145.8750,  10.6250, 238.3750, 165.1250,
           169.6250, 214.6250]]
输出： 
     Y = [[[179.5000, 193.0000, 178.0000,  43.5938,  30.5938, 123.7500,  50.9062,
            105.8750, 188.1250, 184.8750, 179.6250,   9.6797,  44.8125, 210.6250,
            140.3750, 127.9375]]]
```

## 支持芯片型号

| 芯片名称   | 约束                   |
| ---------- | ---------------------- |
| ascend910b | 无                     |
| ascend310p | 不支持bfloat16数据类型 |
